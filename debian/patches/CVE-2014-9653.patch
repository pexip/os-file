Partial backport of https://github.com/file/file/commit/445c8fb0ebff85195be94cd9f7e1df89cade5c7f
diff --git a/src/readelf.c b/src/readelf.c
index adf9867..fd4c0fd 100644
--- a/src/readelf.c
+++ b/src/readelf.c
@@ -326,7 +326,7 @@ dophn_core(struct magic_set *ms, int clazz, int swap, int fd, off_t off,
 			file_badseek(ms);
 			return -1;
 		}
-		if (read(fd, xph_addr, xph_sizeof) == -1) {
+		if (read(fd, xph_addr, xph_sizeof) < (ssize_t)xph_sizeof) {
 			file_badread(ms);
 			return -1;
 		}
@@ -888,7 +888,7 @@ doshn(struct magic_set *ms, int clazz, int swap, int fd, off_t off, int num,
 			file_badseek(ms);
 			return -1;
 		}
-		if (read(fd, xsh_addr, xsh_sizeof) == -1) {
+		if (read(fd, xsh_addr, xsh_sizeof) < (ssize_t)xsh_sizeof) {
 			file_badread(ms);
 			return -1;
 		}
@@ -1086,7 +1086,7 @@ dophn_exec(struct magic_set *ms, int clazz, int swap, int fd, off_t off,
 			return -1;
 		}
 
-  		if (read(fd, xph_addr, xph_sizeof) == -1) {
+  		if (read(fd, xph_addr, xph_sizeof) < (ssize_t)xph_sizeof) {
   			file_badread(ms);
 			return -1;
 		}
